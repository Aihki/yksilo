(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const Z=e=>{const{name:t,address:o}=e,n=document.createElement("tr"),r=document.createElement("td");r.innerText=t.toString();const s=document.createElement("td");return s.innerText=o.toString(),n.appendChild(r),n.appendChild(s),n},F=(e,t)=>{const{name:o,address:n,city:r,postalCode:s,phone:a,company:l}=e;console.log(e);let c=`<h3>${o}</h3>
  <p>${l}</p>
  <p>${n} ${s} ${r}</p>
  <p>${a}</p>
  <table>
    <tr>
      <th>Course</th>
      <th>Diet</th>
      <th>Price</th>
    </tr>
  `;return t.courses.forEach(d=>{const{name:f,diets:y,price:h}=d;c+=`
    <tr>
      <td>${f}</td>
      <td>${y??" - "}</td>
      <td>${h??" - "}</td>
    </tr>
    `}),c+="</table>",console.log(c),c},ee=(e,t)=>{const{name:o,address:n,city:r,postalCode:s,phone:a,company:l}=e;let c=`<h3>${o}</h3>
    <p>${l}</p>
    <p>${n} ${s} ${r}</p>
    <p>${a}</p>
    <table>
    <tr>
      <th>Name</th>
      <th>Diet</th>
      <th>Price</th>
    </tr>`;return t.days.forEach(d=>{const{date:f}=d;c+=`
    <tr>
      <th colspan="3">${f}</th>
    </tr>
  `,d.courses.forEach(y=>{const{name:h,diets:b,price:S}=y;c+=`
            <tr>
              <td>${h}</td>
              <td>${b??" - "}</td>
              <td>${S??" - "}</td>
            </tr>
            `})}),c+="</table>",c},V=e=>`
        <h3>Error</h3>
        <p>${e}</p>
        `,u=async(e,t={})=>{const o=await fetch(e,t);if(!o.ok)throw new Error(`Error ${o.status} occured`);return o.json()},m="https://student-restaurants.azurewebsites.net/api/v1",te="https://student-restaurants.azurewebsites.net/uploads/",oe={enableHighAccuracy:!0,timeout:5e3,maximumAge:0},O=document.getElementById("checkbox");O&&O.addEventListener("change",()=>{document.body.classList.toggle("dark");const e=document.querySelector(".closest");e&&e.classList.toggle("dark");const t=document.querySelector(".edit-grid");t&&t.classList.toggle("dark");const o=document.querySelector("#menuDialog");if(o){o.classList.toggle("dark");const n=o.querySelector("table");n&&n.classList.toggle("dark"),o.querySelectorAll("table td").forEach(a=>{a.classList.toggle("dark")}),o.querySelectorAll("table th").forEach(a=>{a.classList.toggle("dark")})}});let C=!0,k=!0;const g=document.getElementById("logdialog"),Q=document.getElementById("open_logdialog");if(!g||!Q)throw new Error("Dialog or button not found");Q.addEventListener("click",()=>{g&&g.showModal()});const P=document.getElementById("close_log");P&&P.addEventListener("click",()=>{g&&g.close()});const p=document.getElementById("reqdialog"),W=document.getElementById("open_regdialog");if(!p||!W)throw new Error("Dialog or button not found");W.addEventListener("click",()=>{p&&p.showModal()});const U=document.getElementById("close_reg");U&&U.addEventListener("click",()=>{p&&p.close()});const i=document.querySelector("dialog");if(!i)throw new Error("Modal not found");i.addEventListener("click",()=>{i.close()});const M=document.querySelector("#login-form"),q=document.querySelector("#reg-form"),T=document.querySelector("#profile-form"),D=document.querySelector("#avatar-form"),H=document.querySelector("#log-username"),R=document.querySelector("#log-password"),j=document.querySelector("#reg-username"),x=document.querySelector("#reg-password"),_=document.querySelector("#email"),E=document.querySelector("#profile-username"),v=document.querySelector("#profile-email"),w=document.querySelector("#avatar"),N=document.querySelector("#username-target"),z=document.querySelector("#email-target"),J=document.querySelector("#avatar-target"),ne=async e=>{const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return await u(m+"/users",t)},se=async e=>{const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return await u(m+"/auth/login",t)},re=async(e,t)=>{const o=new FormData;o.append("avatar",e);const n={method:"POST",headers:{Authorization:"Bearer "+t},body:o};return await u(m+"/users/avatar",n)},ae=async(e,t)=>{const o={method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t},body:JSON.stringify(e)};return await u(m+"/users",o)},X=e=>{!N||!z||!J||!v||!E||(N.innerHTML=e.username,z.innerHTML=e.email,J.src=te+e.avatar,v.value=e.email,E.value=e.username)},ce=async e=>{const t={headers:{Authorization:"Bearer "+e}};return await u(m+"/users/token",t)},B=async()=>{const e=localStorage.getItem("token");if(!e)return;const t=await ce(e);X(t),console.log(t)};B();M==null||M.addEventListener("submit",async e=>{if(e.preventDefault(),!H||!R)return;const t={username:H.value,password:R.value},o=await se(t);console.log(o),localStorage.setItem("token",o.token),X(o.data),g&&g.close()});q==null||q.addEventListener("submit",async e=>{if(e.preventDefault(),!j||!x||!_)return;const t={username:j.value,email:_.value,password:x.value},o=await ne(t);console.log(o),p&&p.close()});T==null||T.addEventListener("submit",async e=>{if(e.preventDefault(),!E||!v)return;const t={username:E.value,email:v.value},o=localStorage.getItem("token");if(!o)return;const n=await ae(t,o);console.log(n),B()});D==null||D.addEventListener("submit",async e=>{if(e.preventDefault(),!(w!=null&&w.files))return;const t=w.files[0],o=localStorage.getItem("token");if(!o)return;const n=await re(t,o);console.log(n),B()});const $=document.querySelector(".restaurant-table"),I=document.querySelector(".profile-edit"),A=document.getElementById("avatar-target");console.log(A);if(!A)throw new Error("Button does not exist");A.addEventListener("click",()=>{console.log("Avatar clicked"),$&&I&&(k?($.style.display="none",I.style.display="block"):($.style.display="block",I.style.display="none"),k=!k)});const G=(e,t,o,n)=>{let s=L(o-e),a=L(n-t),l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(L(e))*Math.cos(L(o))*Math.sin(a/2)*Math.sin(a/2);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},L=e=>e*(Math.PI/180),K=e=>{const t=document.querySelector("table");if(!t)throw new Error("table doesn't exist");t.querySelectorAll("tr:not(:first-child)").forEach(n=>n.remove()),e.forEach(async(n,r)=>{const s=Z(n);r===0&&(s.classList.contains("closest")||s.classList.add("closest"),s.classList.contains("dark")&&s.classList.contains("closest")&&(s.classList.add("dark"),s.classList.add("closest"))),t&&t.appendChild(s),s.addEventListener("click",async()=>{try{const a=await u(m+`/restaurants/weekly/${n._id}/fi`),l=await u(m+`/restaurants/daily/${n._id}/fi`);if(C===!0){i.innerHTML="";const c=ee(n,a);i.insertAdjacentHTML("beforeend",c),i.showModal()}else{i.innerHTML="";const c=F(n,l);i.insertAdjacentHTML("beforeend",c),i.showModal()}}catch(a){i.innerHTML=V(a.message),i.showModal()}})})},le=e=>{console.warn(`ERROR(${e.code}): ${e.message}`)},ie=async e=>{try{const t=e.coords,o=await u(m+"/restaurants");o.sort((a,l)=>{const c=t.latitude,d=t.longitude,f=a.location.coordinates[1],y=a.location.coordinates[0],h=G(c,d,f,y),b=l.location.coordinates[1],S=l.location.coordinates[0],Y=G(c,d,b,S);return h-Y}),K(o);const n=document.getElementById("searchInput");n&&n.addEventListener("input",()=>{const a=n.value.toLowerCase(),l=o.filter(c=>c.name.toLowerCase().includes(a)||c.company.toLowerCase().includes(a)||c.city.toLowerCase().includes(a)||c.postalCode.toLowerCase().includes(a)||c.address.toLowerCase().includes(a));K(l)});const r=document.querySelector("#weekly_menu"),s=document.querySelector("#daily_menu");r!==null&&r.addEventListener("click",()=>{C=!0}),s!==null&&s.addEventListener("click",()=>{C=!1})}catch(t){i.innerHTML=V(t.message),i.showModal()}};navigator.geolocation.getCurrentPosition(ie,le,oe);
